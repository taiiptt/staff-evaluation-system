<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô - Cross Evaluation @ Accounting</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Enhanced Persistent Database (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏≤‡∏ß‡∏£ + ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
        const PersistentDB = {
            data: {},
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ localStorage ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            isLocalStorageAvailable: () => {
                try {
                    const test = '__localStorage_test__';
                    localStorage.setItem(test, test);
                    localStorage.removeItem(test);
                    return true;
                } catch (e) {
                    return false;
                }
            },

            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å localStorage
            loadFromStorage: (key) => {
                if (!PersistentDB.isLocalStorageAvailable()) return [];
                try {
                    const stored = localStorage.getItem(key);
                    return stored ? JSON.parse(stored) : [];
                } catch (e) {
                    console.warn('Error loading from localStorage:', e);
                    return [];
                }
            },

            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á localStorage
            saveToStorage: (key, data) => {
                if (!PersistentDB.isLocalStorageAvailable()) return false;
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                    return true;
                } catch (e) {
                    console.warn('Error saving to localStorage:', e);
                    return false;
                }
            },

            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            init: (key) => {
                if (!PersistentDB.data[key]) {
                    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å localStorage ‡∏Å‡πà‡∏≠‡∏ô
                    const storedData = PersistentDB.loadFromStorage(key);
                    PersistentDB.data[key] = storedData;
                }
            },

            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
            save: (key, data) => {
                PersistentDB.init(key);
                
                const newEntry = { 
                    ...data, 
                    id: Date.now(), 
                    timestamp: new Date().toISOString(),
                    sessionId: 'session-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9)
                };
                
                PersistentDB.data[key].push(newEntry);
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage
                const saved = PersistentDB.saveToStorage(key, PersistentDB.data[key]);
                
                if (saved) {
                    console.log('‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ñ‡∏≤‡∏ß‡∏£‡πÅ‡∏•‡πâ‡∏ß');
                } else {
                    console.warn('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ñ‡∏≤‡∏ß‡∏£‡πÑ‡∏î‡πâ ‡πÉ‡∏ä‡πâ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß');
                }
                
                return Promise.resolve(newEntry);
            },

            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            getAll: (key) => {
                PersistentDB.init(key);
                return Promise.resolve([...PersistentDB.data[key]]);
            },

            // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            clear: (key) => {
                PersistentDB.data[key] = [];
                PersistentDB.saveToStorage(key, []);
                console.log('üóëÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß');
            },

            // ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô JSON
            exportData: (key) => {
                PersistentDB.init(key);
                const data = {
                    exportDate: new Date().toISOString(),
                    totalRecords: PersistentDB.data[key].length,
                    data: PersistentDB.data[key]
                };
                return JSON.stringify(data, null, 2);
            },

            // ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å JSON
            importData: (key, jsonString) => {
                try {
                    const importedData = JSON.parse(jsonString);
                    if (importedData.data && Array.isArray(importedData.data)) {
                        PersistentDB.data[key] = importedData.data;
                        PersistentDB.saveToStorage(key, PersistentDB.data[key]);
                        return { success: true, count: importedData.data.length };
                    }
                    return { success: false, error: '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á' };
                } catch (e) {
                    return { success: false, error: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå JSON ‡πÑ‡∏î‡πâ' };
                }
            },

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö
            getStorageInfo: () => {
                const isAvailable = PersistentDB.isLocalStorageAvailable();
                let usedSpace = 0;
                
                if (isAvailable) {
                    try {
                        const allKeys = Object.keys(localStorage);
                        usedSpace = allKeys.reduce((total, key) => {
                            return total + (localStorage.getItem(key) || '').length;
                        }, 0);
                    } catch (e) {
                        usedSpace = 0;
                    }
                }
                
                return {
                    available: isAvailable,
                    usedSpace: usedSpace,
                    usedSpaceKB: Math.round(usedSpace / 1024 * 100) / 100
                };
            }
        };

        // Configuration
        const ACCESS_PASSWORD = 'admin123';
        const STORAGE_KEY = 'staff-evaluations';
        const EMPLOYEES = ['Aum', 'Joy', 'Pear', 'Fon'];
        const SCORES = [
            { value: 5, label: '5' },
            { value: 3, label: '3' },
            { value: 1, label: '1' }
        ];
        const MAX_SCORE_PER_CRITERION = 5;

        const ALL_CRITERIA = [
            { id: '1.1', text: '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏¥‡∏ï‡∏£ ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏≤‡∏£‡∏û‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö' },
            { id: '1.2', text: '‡∏°‡∏µ‡∏ô‡πâ‡∏≥‡πÉ‡∏à ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô' },
            { id: '1.3', text: '‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢' },
            { id: '1.4', text: '‡∏™‡∏∏‡∏†‡∏≤‡∏û ‡∏≠‡πà‡∏≠‡∏ô‡∏ô‡πâ‡∏≠‡∏°‡∏ñ‡πà‡∏≠‡∏°‡∏ï‡∏ô ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡∏≠‡∏∑‡πà‡∏ô' },
            { id: '1.5', text: '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• ‡πÅ‡∏•‡∏∞‡∏´‡∏≤‡∏ó‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå' },
            { id: '2.1', text: '‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏¢‡πå ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™ ‡πÅ‡∏•‡∏∞‡∏¢‡∏∂‡∏î‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏ô‡∏à‡∏£‡∏¥‡∏¢‡∏ò‡∏£‡∏£‡∏°' },
            { id: '2.2', text: '‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏ï‡πà‡∏≠‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô ‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î' },
            { id: '2.3', text: '‡∏ï‡∏£‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ß‡∏•‡∏≤ ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏≥‡∏°‡∏±‡πà‡∏ô‡∏™‡∏±‡∏ç‡∏ç‡∏≤ ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô' },
            { id: '2.4', text: '‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô' },
            { id: '3.1', text: '‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà ‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢' },
            { id: '3.2', text: '‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ ‡∏ó‡∏±‡∏Å‡∏©‡∏∞ ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°' },
            { id: '3.3', text: '‡πÉ‡∏ù‡πà‡∏£‡∏π‡πâ ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡∏™‡∏¥‡πà‡∏á‡πÉ‡∏´‡∏°‡πà ‡πÜ ‡∏°‡∏≤‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå‡πÉ‡∏ä‡πâ' },
            { id: '3.4', text: '‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏°' },
            { id: '4.1', text: '‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö' },
            { id: '4.2', text: '‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà ‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û' },
            { id: '4.3', text: '‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏Å‡∏•‡∏±‡∏ß‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß' },
            { id: '4.4', text: '‡∏°‡∏µ‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡∏°/‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á' },
            { id: '5.1', text: '‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏á‡πÄ‡∏ß‡∏•‡∏≤ ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î' },
            { id: '5.2', text: '‡∏à‡∏±‡∏î‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û' },
            { id: '5.3', text: '‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡πÅ‡∏•‡∏∞‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå' },
            { id: '5.4', text: '‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ü‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏µ ‡πÅ‡∏•‡∏∞‡πÉ‡∏™‡πà‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏∑‡πà‡∏ô' },
            { id: '5.5', text: '‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏î‡∏î‡∏±‡∏ô ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á' }
        ];

        const CRITERIA_GROUPS = [
            {
                title: '1. ‡∏î‡πâ‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå',
                criteria: ALL_CRITERIA.filter(c => c.id.startsWith('1.'))
            },
            {
                title: '2. ‡∏î‡πâ‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏¢‡πå',
                criteria: ALL_CRITERIA.filter(c => c.id.startsWith('2.'))
            },
            {
                title: '3. ‡∏î‡πâ‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤',
                criteria: ALL_CRITERIA.filter(c => c.id.startsWith('3.'))
            },
            {
                title: '4. ‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°',
                criteria: ALL_CRITERIA.filter(c => c.id.startsWith('4.'))
            },
            {
                title: '5. ‡∏î‡πâ‡∏≤‡∏ô‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û',
                criteria: ALL_CRITERIA.filter(c => c.id.startsWith('5.'))
            }
        ];

        const TOTAL_CRITERIA_COUNT = ALL_CRITERIA.length;

        // React-like hooks simulation
        let currentComponent = null;
        let stateIndex = 0;
        let states = [];
        let effects = [];
        let effectIndex = 0;

        function useState(initialValue) {
            const index = stateIndex++;
            if (states[index] === undefined) {
                states[index] = initialValue;
            }
            
            const setState = (newValue) => {
                if (typeof newValue === 'function') {
                    states[index] = newValue(states[index]);
                } else {
                    states[index] = newValue;
                }
                if (currentComponent) {
                    currentComponent.render();
                }
            };
            
            return [states[index], setState];
        }

        function useEffect(callback, deps) {
            const index = effectIndex++;
            const prevDeps = effects[index]?.deps;
            
            if (!prevDeps || !deps || deps.some((dep, i) => dep !== prevDeps[i])) {
                if (effects[index]?.cleanup) {
                    effects[index].cleanup();
                }
                const cleanup = callback();
                effects[index] = { deps, cleanup };
            }
        }

        function useCallback(callback, deps) {
            return callback;
        }

        function useMemo(callback, deps) {
            return callback();
        }

        // Persistent Storage hook (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏≤‡∏ß‡∏£)
        function usePersistentStorage() {
            const [storageState, setStorageState] = useState({
                db: PersistentDB,
                userId: 'user-' + Date.now(),
                loading: false,
                error: null,
                storageInfo: PersistentDB.getStorageInfo(),
            });

            return storageState;
        }

        // Utility Components
        const LoadingSpinner = () => `
            <div class="flex justify-center items-center p-6">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                <span class="ml-3 text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
            </div>
        `;

        const Notification = ({ message, type, onClose }) => {
            if (!message) return '';
            const color = type === 'success' ? 'bg-green-100 border-green-400 text-green-700' : 'bg-red-100 border-red-400 text-red-700';
            return `
                <div class="fixed top-4 right-4 z-50 p-4 rounded-lg border shadow-lg transition-opacity duration-300 ${color}" role="alert">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">${message}</span>
                        <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-sm font-bold opacity-70 hover:opacity-100">√ó</button>
                    </div>
                </div>
            `;
        };

        const Card = ({ children, className = '' }) => `
            <div class="bg-white p-6 rounded-xl shadow-2xl ${className}">
                ${children}
            </div>
        `;

        const Button = ({ children, onClick, disabled = false, className = '', type = 'button' }) => `
            <button
                type="${type}"
                onclick="${onClick || ''}"
                ${disabled ? 'disabled' : ''}
                class="px-6 py-3 rounded-xl font-semibold transition-all duration-200 focus:outline-none focus:ring-4 ${
                    disabled
                        ? 'bg-gray-400 text-gray-200 cursor-not-allowed'
                        : 'bg-blue-600 hover:bg-blue-700 text-white shadow-lg shadow-blue-500/50 focus:ring-blue-500/50'
                } ${className}"
            >
                ${children}
            </button>
        `;

        // Password Screen Component
        class PasswordScreen {
            constructor(container, onAccessGranted, onSwitchView) {
                this.container = container;
                this.onAccessGranted = onAccessGranted;
                this.onSwitchView = onSwitchView;
                currentComponent = this;
                stateIndex = 0;
                effectIndex = 0;
            }

            render() {
                const [password, setPassword] = useState('');
                const [error, setError] = useState('');
                const [isSubmitting, setIsSubmitting] = useState(false);

                const handleSubmit = (e) => {
                    e.preventDefault();
                    setIsSubmitting(true);
                    setError('');
                    setTimeout(() => {
                        if (password === ACCESS_PASSWORD) {
                            this.onAccessGranted();
                        } else {
                            setError('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
                        }
                        setIsSubmitting(false);
                    }, 300);
                };

                this.container.innerHTML = `
                    <div class="flex flex-col items-center justify-center min-h-screen bg-gray-50 p-4">
                        ${Card({
                            children: `
                                <h1 class="text-3xl font-extrabold text-blue-700 mb-6 text-center">üîê ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</h1>
                                <p class="text-gray-600 mb-6 text-center">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠</p>
                                <form id="passwordForm" class="space-y-4">
                                    <div>
                                        <input
                                            type="password"
                                            id="passwordInput"
                                            placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"
                                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                            required
                                        />
                                    </div>
                                    <div id="errorMessage" class="text-red-500 text-sm" style="display: ${error ? 'block' : 'none'}">${error}</div>
                                    ${Button({
                                        children: isSubmitting ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...' : '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î',
                                        type: 'submit',
                                        disabled: isSubmitting,
                                        className: 'w-full'
                                    })}
                                    <button type="button" onclick="app.switchView('form')" class="w-full text-center text-sm text-gray-500 hover:text-blue-600 mt-2 transition-colors">
                                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°
                                    </button>
                                </form>
                            `,
                            className: 'max-w-md w-full'
                        })}
                    </div>
                `;

                document.getElementById('passwordForm').onsubmit = handleSubmit;
                document.getElementById('passwordInput').oninput = (e) => {
                    setPassword(e.target.value);
                    setError('');
                };
            }
        }

        // Form Screen Component
        class FormScreen {
            constructor(container, db, userId, onSwitchView) {
                this.container = container;
                this.db = db;
                this.userId = userId;
                this.onSwitchView = onSwitchView;
                currentComponent = this;
                stateIndex = 0;
                effectIndex = 0;
            }

            render() {
                const initialScores = ALL_CRITERIA.reduce((acc, c) => {
                    acc[c.id] = EMPLOYEES.reduce((empAcc, emp) => ({ ...empAcc, [emp]: null }), {});
                    return acc;
                }, {});

                const [scores, setScores] = useState(initialScores);
                const [isSubmitting, setIsSubmitting] = useState(false);
                const [message, setMessage] = useState(null);
                const [storageInfo, setStorageInfo] = useState(this.db.getStorageInfo());

                const handleScoreChange = (criteriaId, employeeName, value) => {
                    setScores(prevScores => ({
                        ...prevScores,
                        [criteriaId]: {
                            ...prevScores[criteriaId],
                            [employeeName]: value,
                        },
                    }));
                };

                const isFormValid = ALL_CRITERIA.every(criteria =>
                    EMPLOYEES.every(employee => scores[criteria.id] && scores[criteria.id][employee] !== null)
                );

                const handleSubmit = async (e) => {
                    e.preventDefault();
                    if (!isFormValid || isSubmitting) return;

                    setIsSubmitting(true);
                    
                    const evaluatorName = 'Cross Evaluation @ Accounting';
                    
                    const evaluationData = {
                        evaluatorId: this.userId,
                        evaluatorName: evaluatorName,
                        scores: scores,
                    };

                    try {
                        await this.db.save(STORAGE_KEY, evaluationData);
                        setMessage({ text: '‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ñ‡∏≤‡∏ß‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏∞/‡∏Ñ‡∏£‡∏±‡∏ö', type: 'success' });
                        setScores(initialScores);
                        setStorageInfo(this.db.getStorageInfo());
                        
                        // Auto refresh dashboard if it exists
                        setTimeout(() => {
                            if (window.app && window.app.view === 'dashboard') {
                                window.app.render();
                            }
                        }, 1000);
                    } catch (error) {
                        console.error("Error saving data: ", error);
                        setMessage({ text: `‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${error.message}`, type: 'error' });
                    } finally {
                        setIsSubmitting(false);
                    }
                };

                this.container.innerHTML = `
                    <div class="min-h-screen bg-gray-50 p-4 md:p-8">
                        ${message ? Notification({ message: message.text, type: message.type, onClose: () => setMessage(null) }) : ''}
                        <header class="flex justify-between items-center mb-6 border-b pb-4">
                            <h1 class="text-2xl md:text-3xl font-extrabold text-blue-700">‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á (Staff Evaluation) Cross Evaluation @ Accounting</h1>
                            ${Button({
                                children: '‡∏î‡∏π‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•',
                                onClick: "app.switchView('dashboard')",
                                className: 'px-4 py-2 text-sm bg-blue-600 hover:bg-blue-700 shadow-blue-500/50'
                            })}
                        </header>
                        
                        ${Card({
                            children: `
                                <h2 class="text-xl font-semibold text-gray-800 mb-2">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h2>
                                <p class="text-gray-600 text-sm">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á 4 ‡∏ó‡πà‡∏≤‡∏ô ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡πÄ‡∏Å‡∏ì‡∏ë‡πå ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á</p>
                                <p class="text-gray-600 text-sm">‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: **5 / 3 / 1**</p>
                                <div class="mt-3 p-3 ${storageInfo.available ? 'bg-green-50 border-l-4 border-green-400' : 'bg-yellow-50 border-l-4 border-yellow-400'} rounded">
                                    <p class="text-sm font-medium ${storageInfo.available ? 'text-green-800' : 'text-yellow-800'}">
                                        ${storageInfo.available 
                                            ? `üíæ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏≤‡∏ß‡∏£: ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡πÉ‡∏ä‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ${storageInfo.usedSpaceKB} KB)`
                                            : '‚ö†Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏≤‡∏ß‡∏£: ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß'
                                        }
                                    </p>
                                </div>
                            `,
                            className: 'mb-8'
                        })}

                        <form id="evaluationForm" class="space-y-8">
                            ${Card({
                                children: `
                                    <h2 class="text-xl font-semibold text-gray-800 mb-4">‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h2>
                                    ${CRITERIA_GROUPS.map(group => `
                                        <div class="mb-6">
                                            <h3 class="text-lg font-bold text-blue-600 p-2 bg-blue-50 rounded-lg shadow-inner mb-3">${group.title}</h3>
                                            <div class="overflow-x-auto rounded-xl border border-gray-200 shadow-lg">
                                                <table class="min-w-full divide-y divide-gray-200">
                                                    <thead class="bg-gray-50 sticky top-0 z-10">
                                                        <tr>
                                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/3">
                                                                ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤
                                                            </th>
                                                            ${EMPLOYEES.map(emp => `
                                                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-1/6">
                                                                    ${emp}
                                                                </th>
                                                            `).join('')}
                                                        </tr>
                                                    </thead>
                                                    <tbody class="bg-white divide-y divide-gray-200">
                                                        ${group.criteria.map(criteria => `
                                                            <tr class="criteria-row" data-criteria="${criteria.id}">
                                                                <td class="p-4 whitespace-normal text-sm font-medium text-gray-900 border-r border-gray-100">
                                                                    <span class="font-bold mr-2 text-blue-500">${criteria.id}</span> ${criteria.text}
                                                                </td>
                                                                ${EMPLOYEES.map(employee => `
                                                                    <td class="p-2 text-center border-r last:border-r-0 border-gray-100">
                                                                        <div class="flex flex-col items-center space-y-1">
                                                                            ${SCORES.map(score => `
                                                                                <label class="relative p-2 w-full cursor-pointer rounded-lg transition-all duration-150 score-option bg-gray-100 hover:bg-blue-100 text-gray-700">
                                                                                    <input
                                                                                        type="radio"
                                                                                        name="score-${criteria.id}-${employee}"
                                                                                        value="${score.value}"
                                                                                        class="hidden score-input"
                                                                                        data-criteria="${criteria.id}"
                                                                                        data-employee="${employee}"
                                                                                    />
                                                                                    <span class="text-sm font-bold">${score.label}</span>
                                                                                </label>
                                                                            `).join('')}
                                                                        </div>
                                                                    </td>
                                                                `).join('')}
                                                            </tr>
                                                        `).join('')}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    `).join('')}
                                `
                            })}

                            <div class="sticky bottom-0 bg-white p-4 rounded-xl shadow-2xl flex justify-center">
                                ${Button({
                                    children: isSubmitting ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...' : '‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô',
                                    type: 'submit',
                                    disabled: !isFormValid || isSubmitting
                                })}
                            </div>
                        </form>
                    </div>
                `;

                // Add event listeners
                document.getElementById('evaluationForm').onsubmit = handleSubmit;
                
                document.querySelectorAll('.score-input').forEach(input => {
                    input.onchange = (e) => {
                        const criteriaId = e.target.dataset.criteria;
                        const employee = e.target.dataset.employee;
                        const value = parseInt(e.target.value);
                        
                        handleScoreChange(criteriaId, employee, value);
                        
                        // Update UI
                        const row = document.querySelector(`[data-criteria="${criteriaId}"]`);
                        const allFilled = EMPLOYEES.every(emp => {
                            return document.querySelector(`input[name="score-${criteriaId}-${emp}"]:checked`);
                        });
                        
                        if (allFilled) {
                            row.classList.remove('bg-red-50/50');
                        } else {
                            row.classList.add('bg-red-50/50');
                        }
                        
                        // Update button styles
                        e.target.parentElement.parentElement.querySelectorAll('.score-option').forEach(option => {
                            option.classList.remove('bg-blue-600', 'text-white', 'shadow-md');
                            option.classList.add('bg-gray-100', 'hover:bg-blue-100', 'text-gray-700');
                        });
                        
                        e.target.parentElement.classList.remove('bg-gray-100', 'hover:bg-blue-100', 'text-gray-700');
                        e.target.parentElement.classList.add('bg-blue-600', 'text-white', 'shadow-md');
                        
                        // Update submit button
                        const submitButton = document.querySelector('button[type="submit"]');
                        const allValid = ALL_CRITERIA.every(criteria =>
                            EMPLOYEES.every(employee => 
                                document.querySelector(`input[name="score-${criteria.id}-${employee}"]:checked`)
                            )
                        );
                        
                        if (allValid) {
                            submitButton.disabled = false;
                            submitButton.classList.remove('bg-gray-400', 'text-gray-200', 'cursor-not-allowed');
                            submitButton.classList.add('bg-blue-600', 'hover:bg-blue-700', 'text-white');
                        }
                    };
                });
            }
        }

        // Dashboard Screen Component
        class DashboardScreen {
            constructor(container, db, onSwitchView) {
                this.container = container;
                this.db = db;
                this.onSwitchView = onSwitchView;
                currentComponent = this;
                stateIndex = 0;
                effectIndex = 0;
            }

            render() {
                const [evaluations, setEvaluations] = useState([]);
                const [loading, setLoading] = useState(true);
                const [storageInfo, setStorageInfo] = useState(this.db.getStorageInfo());

                useEffect(() => {
                    const loadEvaluations = async () => {
                        try {
                            const data = await this.db.getAll(STORAGE_KEY);
                            setEvaluations(data);
                            setStorageInfo(this.db.getStorageInfo());
                            setLoading(false);
                        } catch (error) {
                            console.error("Error loading evaluations:", error);
                            setLoading(false);
                        }
                    };

                    loadEvaluations();
                }, [this.db]);

                const summaryData = useMemo(() => {
                    const results = EMPLOYEES.reduce((acc, emp) => ({
                        ...acc,
                        [emp]: { totalScore: 0, count: 0, criteriaScores: {} }
                    }), {});

                    if (evaluations.length === 0) return { results, totalSubmissions: 0 };

                    let totalSubmissions = 0;
                    const allCriteriaScores = {};

                    evaluations.forEach(submission => {
                        if (submission.scores) {
                            totalSubmissions++;
                        }
                        const scores = submission.scores || {};

                        ALL_CRITERIA.forEach(criteria => {
                            const criteriaId = criteria.id;
                            
                            if (!allCriteriaScores[criteriaId]) {
                                allCriteriaScores[criteriaId] = EMPLOYEES.reduce((acc, emp) => ({ ...acc, [emp]: [] }), {});
                            }

                            EMPLOYEES.forEach(employee => {
                                const score = scores[criteriaId]?.[employee];
                                if (typeof score === 'number') {
                                    results[employee].totalScore += score;
                                    results[employee].count++;
                                    allCriteriaScores[criteriaId][employee].push(score);
                                }
                            });
                        });
                    });

                    const finalResults = EMPLOYEES.map(emp => {
                        const avg = results[emp].count > 0 ? (results[emp].totalScore / results[emp].count) : 0;
                        const percentageScore = (avg / MAX_SCORE_PER_CRITERION) * 100;

                        return { 
                            name: emp, 
                            averageScore: parseFloat(avg.toFixed(2)),
                            percentageScore: parseFloat(percentageScore.toFixed(2)) 
                        };
                    });

                    const criteriaAverages = ALL_CRITERIA.map(criteria => {
                        const criteriaId = criteria.id;
                        const avgByEmployee = {};
                        EMPLOYEES.forEach(employee => {
                            const scoresList = allCriteriaScores[criteriaId]?.[employee] || [];
                            const sum = scoresList.reduce((a, b) => a + b, 0);
                            const avg = scoresList.length > 0 ? (sum / scoresList.length).toFixed(2) : 'N/A';
                            avgByEmployee[employee] = avg;
                        });
                        return { id: criteriaId, text: criteria.text, ...avgByEmployee };
                    });

                    return { finalResults, criteriaAverages, totalSubmissions };
                }, [evaluations]);

                const { finalResults, criteriaAverages, totalSubmissions } = summaryData;

                const handleExportData = () => {
                    try {
                        const exportData = this.db.exportData(STORAGE_KEY);
                        const blob = new Blob([exportData], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `staff-evaluation-backup-${new Date().toISOString().split('T')[0]}.json`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                    } catch (error) {
                        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message);
                    }
                };

                const handleImportData = () => {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.json';
                    input.onchange = (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                try {
                                    const result = this.db.importData(STORAGE_KEY, e.target.result);
                                    if (result.success) {
                                        alert(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${result.count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
                                        // Reload data
                                        this.render();
                                    } else {
                                        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + result.error);
                                    }
                                } catch (error) {
                                    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message);
                                }
                            };
                            reader.readAsText(file);
                        }
                    };
                    input.click();
                };

                const handleClearData = () => {
                    if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ!')) {
                        this.db.clear(STORAGE_KEY);
                        setEvaluations([]);
                        setStorageInfo(this.db.getStorageInfo());
                        alert('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                    }
                };

                if (loading) {
                    this.container.innerHTML = LoadingSpinner();
                    return;
                }

                this.container.innerHTML = `
                    <div class="min-h-screen bg-gray-50 p-4 md:p-8">
                        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 pb-4 border-b-4 border-blue-600">
                            <h1 class="text-4xl font-extrabold text-blue-700 mb-2 md:mb-0">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô (Real-time)</h1>
                            <div class="flex flex-wrap gap-2">
                                ${Button({
                                    children: '‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°',
                                    onClick: "app.switchView('form')",
                                    className: 'px-4 py-2 text-sm'
                                })}
                            </div>
                        </header>

                        ${Card({
                            children: `
                                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
                                    <div>
                                        <h2 class="text-2xl font-bold text-gray-800 mb-2">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h2>
                                        <p class="text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß: <span class="text-3xl font-extrabold text-blue-700">${totalSubmissions}</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                                        <p class="text-sm ${storageInfo.available ? 'text-green-600' : 'text-yellow-600'}">
                                            ${storageInfo.available 
                                                ? `üíæ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ñ‡∏≤‡∏ß‡∏£ (${storageInfo.usedSpaceKB} KB)`
                                                : '‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß'
                                            }
                                        </p>
                                    </div>
                                    <div class="flex flex-wrap gap-2 mt-4 md:mt-0">
                                        <button onclick="(${handleExportData})()" class="px-3 py-2 text-sm bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                                            üì• ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                                        </button>
                                        <button onclick="(${handleImportData})()" class="px-3 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                                            üì§ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                                        </button>
                                        <button onclick="(${handleClearData})()" class="px-3 py-2 text-sm bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors">
                                            üóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                                        </button>
                                    </div>
                                </div>
                            `,
                            className: 'mb-8 bg-blue-50 border-t-8 border-blue-600'
                        })}

                        ${totalSubmissions === 0 ? `
                            <div class="text-center p-10 bg-white rounded-xl shadow-lg text-gray-500">
                                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô ‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤
                            </div>
                        ` : `
                            <div class="space-y-10">
                                ${Card({
                                    children: `
                                        <h2 class="text-2xl font-bold text-gray-800 mb-6">‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå)</h2>
                                        <p class="text-gray-600 text-sm mb-4">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${TOTAL_CRITERIA_COUNT} ‡πÄ‡∏Å‡∏ì‡∏ë‡πå x 5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô = ${TOTAL_CRITERIA_COUNT * 5} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                                            ${finalResults.sort((a, b) => b.percentageScore - a.percentageScore).map((result, index) => `
                                                <div class="p-4 bg-blue-50 border-l-4 border-blue-600 rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300">
                                                    <p class="text-lg font-semibold text-gray-600 mb-1">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà ${index + 1}</p>
                                                    <p class="text-3xl font-extrabold text-blue-700">${result.name}</p>
                                                    <p class="text-4xl font-extrabold text-gray-900 mt-2">
                                                        ${result.percentageScore}%
                                                        <span class="text-xl font-normal text-gray-500 ml-2">(${result.averageScore}/5)</span>
                                                    </p>
                                                </div>
                                            `).join('')}
                                        </div>
                                    `
                                })}

                                ${Card({
                                    children: `
                                        <h2 class="text-2xl font-bold text-gray-800 mb-6">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏Å‡∏ì‡∏ë‡πå (Score per Criteria: Max 5.00)</h2>
                                        <div class="overflow-x-auto rounded-xl border border-gray-200 shadow-lg">
                                            <table class="min-w-full divide-y divide-gray-200">
                                                <thead class="bg-gray-50 sticky top-0 z-10">
                                                    <tr>
                                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/3">
                                                            ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤
                                                        </th>
                                                        ${EMPLOYEES.map(emp => `
                                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-1/6">
                                                                ${emp}
                                                            </th>
                                                        `).join('')}
                                                    </tr>
                                                </thead>
                                                <tbody class="bg-white divide-y divide-gray-200">
                                                    ${criteriaAverages.map(criteria => `
                                                        <tr>
                                                            <td class="p-4 whitespace-normal text-sm font-medium text-gray-900 border-r border-gray-100">
                                                                <span class="font-bold mr-2 text-blue-500">${criteria.id}</span> ${criteria.text}
                                                            </td>
                                                            ${EMPLOYEES.map(employee => {
                                                                const score = parseFloat(criteria[employee]);
                                                                const colorClass = score >= 4.5 ? 'bg-green-100 text-green-700' :
                                                                                 score >= 3.0 ? 'bg-yellow-100 text-yellow-700' :
                                                                                 'bg-red-100 text-red-700';
                                                                return `
                                                                    <td class="p-2 text-center font-bold border-r last:border-r-0 border-gray-100 transition-colors duration-200 ${colorClass}">
                                                                        ${criteria[employee]}
                                                                    </td>
                                                                `;
                                                            }).join('')}
                                                        </tr>
                                                    `).join('')}
                                                </tbody>
                                            </table>
                                        </div>
                                    `
                                })}
                            </div>
                        `}
                    </div>
                `;
            }
        }

        // Main App Class
        class App {
            constructor() {
                this.container = document.getElementById('app');
                this.isDashboardUnlocked = false;
                this.view = 'form';
                
                currentComponent = this;
                stateIndex = 0;
                effectIndex = 0;
                
                this.firebaseState = this.useFirebase();
                this.render();
            }

            useFirebase() {
                return usePersistentStorage();
            }

            handleAccessGranted() {
                this.isDashboardUnlocked = true;
                this.view = 'dashboard';
                this.render();
            }

            switchView(targetView) {
                if (targetView === 'dashboard' && !this.isDashboardUnlocked) {
                    this.view = 'password_for_dashboard';
                } else {
                    this.view = targetView;
                }
                this.render();
            }

            render() {
                const { db, userId, loading, error } = this.firebaseState;

                if (loading) {
                    this.container.innerHTML = LoadingSpinner();
                    return;
                }

                if (error) {
                    this.container.innerHTML = `
                        <div class="text-center p-10 text-red-600 bg-red-50 min-h-screen">
                            <h1 class="text-2xl font-bold">Storage Error</h1>
                            <p>${error}</p>
                        </div>
                    `;
                    return;
                }

                // Main View Routing - Enhanced version
                let CurrentScreen;
                if (this.view === 'password_for_dashboard') {
                    // Show password screen if trying to access dashboard without unlocking
                    CurrentScreen = new PasswordScreen(
                        this.container,
                        () => this.handleAccessGranted(),
                        (view) => this.switchView(view)
                    );
                } else if (this.view === 'form') {
                    CurrentScreen = new FormScreen(
                        this.container,
                        db,
                        userId,
                        (view) => this.switchView(view)
                    );
                } else if (this.view === 'dashboard') {
                    CurrentScreen = new DashboardScreen(
                        this.container,
                        db,
                        (view) => this.switchView(view)
                    );
                } else {
                    // Error state for invalid view
                    this.container.innerHTML = `
                        <div class="font-sans antialiased">
                            <div class="p-10 text-red-500 text-center min-h-screen bg-red-50">
                                <h1 class="text-2xl font-bold mb-4">Error: Invalid view state</h1>
                                <p class="mb-4">Current view: ${this.view}</p>
                                <button onclick="app.switchView('form')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                    ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°
                                </button>
                            </div>
                        </div>
                    `;
                    return;
                }

                // Render the current screen with font styling wrapper
                this.container.innerHTML = `<div class="font-sans antialiased"></div>`;
                const wrapper = this.container.querySelector('.font-sans');
                CurrentScreen.container = wrapper;
                CurrentScreen.render();
            }
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.app = new App();
        });

        // Export for compatibility (if needed)
        if (typeof module !== 'undefined' && module.exports) {
            module.exports = App;
        }
    </script>
    <style>
        body {
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div id="app"></div>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98837ddfa6fb1d37',t:'MTc1OTQwMDY4My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
